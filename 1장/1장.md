# 1장 - 마이크로서비스란?

## 마이크로서비스 살펴보기

- 마이크로서비스는 외부에서 보면 블랙박스 취급된다.
  - 상세한 내부구현 상태는 외부 세계에서 완전히 은폐될 수 있다.
- 마이크로서비스는 정보 은닉이 가능하다
  - 외부대상에게 감춰진 구현은 마이크로 서비스가 노출하는 네트워크 인터페이스가 하위 호환성을 깨트리는 방식으로 바뀌지 않는 한 자유롭게 변경될 수 있다.

## 마이크로서비스 핵심 개념

### 독립적 배포성

하나의 마이크로서비스를 배포하려 할 때, 다른 마이크로서비스를 변경하지 않고도 배포할 수 있다.

독립적 배포를 위해 마이크로서비스는 서로 느슨하게 결합되어 있어야 한다.

- 서비스 간 분명하고 잘 정의되고 안정적인 계약이 필요하다
- 특히 DB 공유는 지양해야 함

### 비즈니스 도메인 중심의 모델링

마이크로서비스를 통해 소프트웨어가 동작하는 실제 도메인을 더 잘 표현할 수 있도록 코드를 구성할 수 있다.

서비스를 비즈니스 기능 단위로 처음부터 끝까지 한 조각으로 만들면 비즈니스 기능을 최대한 효율적으로 변경하도록 아키텍처를 설계할 수 있다.

자기 상태 소유

- 마이크로서비스간 통신은 어떤 데이터를 공유하고 감출지를 결정하는 능력을 제공한다.
  - 이는 자유롭게 변경할 수 있는 기능, 거의 변경하지 않는 기능을 명확히 분리할 수 있게 되낟.
- 독립적 배포성을 실현하려면 마이크로서비스에 대한 하위 호환성이 없는 변경을 제한해야 한다.

### 크기

마이크로서비스 간의 크기는 쉽게 이해할 수 있는 크기로 유지되어야 한다.

크기에 대한 걱정보단 아래의 핵심사항에 집중해라

- 얼마나 많은 마이크로서비스를 처리할 수 있는지
  - 마이크로서비스로의 전환은 복잡성을 유발하므로 점진적인 전환을 하는 것이 좋다
- 모든 것이 끔찍하게 결합되는 것을 막으면서도 마이크로서비스 경계를 최대한 활용하려면 어떻게 할 것인가?

### 유연성

마이크로서비스는 비용이 들기 때문에 비용이 선택하려는 옵션의 가치에 견줘 적당한지 판단해야 한다.

## 모놀리스

- 단일 프로세스형 모놀리스
- 모듈식 모놀리스
  - 각 모듈은 독립적으로 작업이 가능하나, 배포하려면 모두가 합쳐져야 한다.
  - 코드 수준으로 분리가 되진 않아 모놀리스를 분리하려 할 때 문제가 될 수 있음
- 분산형 모놀리스
  - 여러 서비스로 구성되어 있으나, 어떤 이유로든 전체 시스템을 같이 배포해야 하는 경우

모놀리스의 장점

- 자기 내부 코드를 재사용할 수 있다.

## 활성화 기술

### 로그 집계와 분산 추적

- 로그집계를 통해 모든 서비스의 로그를 수집, 집계하고 한 곳에서 분석할 수 있게 된다.

### 컨테이너와 K8s

- 컨테이너를 통해 간편하게 격리된 실행환경을 프로비저닝할 수 있다.
- 여러 컨테이너를 관리하기 위한 오케스트레이션 플랫폼을 사용할 수도 있다.

### 스트리밍

- 마이크로서비스간 데이터 공유를 위한 방법
  - ex 카프카

### 공용 클라우드 및 서버리스

## 마이크로서비스의 장점

### 기술 이질성

각각 다른 마이크로서비스에 서로 다른 기술들을 사용할 수 있게 된다.

새로운 기술 도입을 위해 위험이 가장 낮은 마이크로서비스에서 테스트가 가능해져 새로운 기술 흡수가 빨라진다.

### 견고성

서비스의 경계가 벌크헤드가 되어준다.

하나의 서비스가 마비되어도 이로 인한 파급력을 줄일 수 있다.

주의사항 : 마이크로 서비스 시스템이 향상된 견고함을 수용할 수 있게 하려면 분산시스템이 처리해야 할 새로운 고장원인을 이해해야 함

### 확장성

### 배포 용이성

모놀리스는 한줄 만 수정을 하더라도 전체 어플리케이션을 다 배포해야 하나, 마이크로서비스는 독립적 배포로 부담을 줄일 수 있다.

### 조직적 정렬

아키텍처를 조직구조에 맞게 더 적절히 정렬할 수 있고, 팀 크키와 생산성의 최적점에 도달하기 위해 하나의 코드베이스에서 일하는 인원을 최소화 할 수 있다.

### 조합성

재사용이 가능함

## 마이크로서비스의 고충

개발자 경험
기술과다
비용
리포팅
모니터링과 문제 해결
보안
테스팅
지연 시간
데이터 일관성

## 마이크로 서비스를 사용해야 하는가?

### 적합하지 않은 곳

작업중인 도메인의 경계가 자주 변할 경우 변경으로 인한 비용이 많이 들 수 있다.
비용이 많이 들으므로 소규모팀인 경우 마이크로서비스가 비추천된다.
고객이 배포하고 관리할 소프트웨어를 만드는 경우

### 적합한 곳

조직 규모가 큰 경우
연중무휴로 돌아가 독립적인 배포가 중요한 경우
새로운 채널을 통해 고객 서비스를 제공해야 하는 경우
